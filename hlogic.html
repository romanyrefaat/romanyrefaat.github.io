<!DOCTYPE html>
<html>
    <head>
        <title>Higher Logic POC</title>
        <style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style>
    </head>
    <body>
        <div style="max-width: 500px;">
            <input class="js--demo" type="button" value="Record a video ..." style="display: none;"/>
        </div>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
        <script>
            var elem = $('.js--demo'),
                    APIBaseURL = 'https://apitest.gv-one.com/api/v1/',
                    redirectURl = window.location.href, // same page for demo only, use a standalone URL to handle video recording callback,
                    commonAPISettings = {
                        'Content-Type': 'application/json',
                        crossDomain: true,
                        dataType: 'json',
                        headers: {
                            'accessToken': 'dobnobZ_CiBgTGjCEuhubXm5fbnY0DJY3a2MVZzpkd0izO5OycsdNwcFiTPB-dgAy2PJrImPQ2y8wdgw',
                            'Content-Type': 'application/json'
                        }
                    };
            function videoReceived(video) {
                elem.val('Loading video...').prop('disabled', true);
                $.ajax($.extend({}, commonAPISettings, {
                    url: APIBaseURL + 'video/' + video,
                    method: 'GET'
                })).done(function (response) {
                    elem.replaceWith('<div class="embed-container"><iframe src="' + response.videoEmbedURL + '" style="border:0"></iframe></div>')
                });
            }
            $(function () {
                if ($.urlParam('video')) {
                    // Logic here should be added to the standalone redirect URL
                    window.opener.videoReceived($.urlParam('video'));
                    window.close();
                } else {
                    elem.show().on('click', function () {
                        elem.data('val', elem.val()).val('Please wait...').prop('disabled', true);
                        $.ajax($.extend({}, commonAPISettings, {
                            url: APIBaseURL + 'user/signing',
                            method: 'POST',
                            data: JSON.stringify({"expire": 604800, "redirectURl": redirectURl, "requestId": "512", "uuid": "HigherLogic_1000"}),
                        })).done(function (response) {
                            var width = 1000,
                                    height = 500,
                                    left = (screen.width / 2) - (width / 2),
                                    top = (screen.height / 2) - (height / 2);
                            window.open(response.data.recordingPageUrl, 'gv_recording', 'width=' + width + ',height=' + height + ',top=' + top + ',left=' + left + '');
                            elem.prop('disabled', false).val(elem.data('val'));
                        });
                    });
                }
            });
            $.urlParam = function (name) {
                var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
                return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
            }
        </script>
    </body>
</html>
